### ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ

å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚æ— è®ºåœ¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹è·å–è¯¥ç±»çš„å®ä¾‹ï¼Œå¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

#### æ ¸å¿ƒæ€æƒ³

æ§åˆ¶å®ä¾‹æ•°é‡ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€

---

#### å·¥ä½œåŸç†

```
                    å•ä¾‹æ¨¡å¼å·¥ä½œæµç¨‹

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚              å®¢æˆ·ç«¯ä»£ç                            â”‚
   â”‚                                                  â”‚
   â”‚  Singleton instance1 = Singleton.getInstance(); â”‚
   â”‚  Singleton instance2 = Singleton.getInstance(); â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è°ƒç”¨é™æ€æ–¹æ³•
                     â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    Singleton ç±»          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
         â†“                           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ instance ==  â”‚          â”‚ instance !=  â”‚
  â”‚   null ?     â”‚          â”‚   null ?     â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â†“                           â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚ åˆ›å»ºæ–°å®ä¾‹   â”‚                  â”‚
  â”‚ instance =   â”‚                  â”‚
  â”‚ new Singletonâ”‚                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     è¿”å› instance         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### å•ä¾‹å®ç°æ–¹å¼å¯¹æ¯”

| å®ç°æ–¹å¼ | çº¿ç¨‹å®‰å…¨ | å»¶è¿ŸåŠ è½½ | å®ç°éš¾åº¦ | æ¨èåº¦ |
|:--------|:-------:|:-------:|:-------:|:-----:|
| é¥¿æ±‰å¼ | âœ… | âŒ | â­ | â­â­â­ |
| æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ | âŒ | âœ… | â­ | â­ |
| æ‡’æ±‰å¼ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰ | âœ… | âœ… | â­â­ | â­â­ |
| åŒé‡æ£€æŸ¥é” | âœ… | âœ… | â­â­â­ | â­â­â­â­â­ |
| é™æ€å†…éƒ¨ç±» | âœ… | âœ… | â­â­ | â­â­â­â­â­ |
| æšä¸¾ | âœ… | âŒ | â­â­ | â­â­â­â­â­ |

---

#### å®Œæ•´ä»£ç ç¤ºä¾‹

**åœºæ™¯ï¼šæ•°æ®åº“è¿æ¥æ± ç®¡ç†å™¨**

```java
import java.util.*;
import java.util.concurrent.atomic.AtomicInteger;

// ==================== 1. é¥¿æ±‰å¼ ====================

/**
 * é¥¿æ±‰å¼å•ä¾‹
 * åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨
 *
 * ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œçº¿ç¨‹å®‰å…¨
 * ç¼ºç‚¹ï¼šæ— è®ºæ˜¯å¦ä½¿ç”¨éƒ½ä¼šåˆ›å»ºå®ä¾‹ï¼Œå¯èƒ½é€ æˆèµ„æºæµªè´¹
 */
class EagerSingleton {
    // â”€â”€ é™æ€å®ä¾‹ï¼Œç±»åŠ è½½æ—¶åˆå§‹åŒ– â”€â”€
    private static final EagerSingleton INSTANCE = new EagerSingleton();

    // â”€â”€ ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»º â”€â”€
    private EagerSingleton() {
        System.out.println("ğŸ”„ é¥¿æ±‰å¼å•ä¾‹ï¼šå®ä¾‹å·²åˆ›å»º");
    }

    // â”€â”€ å…¬å…±é™æ€è®¿é—®æ–¹æ³• â”€â”€
    public static EagerSingleton getInstance() {
        return INSTANCE;
    }

    // â”€â”€ ä¸šåŠ¡æ–¹æ³• â”€â”€
    public void doSomething() {
        System.out.println("ğŸ“Œ é¥¿æ±‰å¼å•ä¾‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘");
    }
}

// ==================== 2. æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ ====================

/**
 * æ‡’æ±‰å¼å•ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰
 * ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰åˆ›å»ºå®ä¾‹
 *
 * ä¼˜ç‚¹ï¼šå»¶è¿ŸåŠ è½½ï¼ŒèŠ‚çœèµ„æº
 * ç¼ºç‚¹ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å®‰å…¨
 */
class LazySingletonUnsafe {
    // â”€â”€ é™æ€å®ä¾‹ï¼Œåˆå§‹ä¸º null â”€â”€
    private static LazySingletonUnsafe instance;

    // â”€â”€ ç§æœ‰æ„é€ æ–¹æ³• â”€â”€
    private LazySingletonUnsafe() {
        System.out.println("ğŸ”„ æ‡’æ±‰å¼å•ä¾‹ï¼ˆä¸å®‰å…¨ï¼‰ï¼šå®ä¾‹å·²åˆ›å»º");
    }

    // â”€â”€ å…¬å…±é™æ€è®¿é—®æ–¹æ³•ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰â”€â”€
    public static LazySingletonUnsafe getInstance() {
        if (instance == null) {
            instance = new LazySingletonUnsafe();
        }
        return instance;
    }

    public void doSomething() {
        System.out.println("ğŸ“Œ æ‡’æ±‰å¼å•ä¾‹ï¼ˆä¸å®‰å…¨ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘");
    }
}

// ==================== 3. æ‡’æ±‰å¼ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰ ====================

/**
 * æ‡’æ±‰å¼å•ä¾‹ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰
 * é€šè¿‡ synchronized ä¿è¯çº¿ç¨‹å®‰å…¨
 *
 * ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½
 * ç¼ºç‚¹ï¼šæ¯æ¬¡è·å–å®ä¾‹éƒ½è¦åŠ é”ï¼Œæ€§èƒ½è¾ƒå·®
 */
class LazySingletonSync {
    private static LazySingletonSync instance;

    private LazySingletonSync() {
        System.out.println("ğŸ”„ æ‡’æ±‰å¼å•ä¾‹ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰ï¼šå®ä¾‹å·²åˆ›å»º");
    }

    // â”€â”€ åŒæ­¥æ–¹æ³•ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ â”€â”€
    public static synchronized LazySingletonSync getInstance() {
        if (instance == null) {
            instance = new LazySingletonSync();
        }
        return instance;
    }

    public void doSomething() {
        System.out.println("ğŸ“Œ æ‡’æ±‰å¼å•ä¾‹ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘");
    }
}

// ==================== 4. åŒé‡æ£€æŸ¥é”ï¼ˆDouble-Check Lockingï¼‰ ====================

/**
 * åŒé‡æ£€æŸ¥é”å•ä¾‹
 * æ¨èçš„æ‡’åŠ è½½å®ç°æ–¹å¼
 *
 * ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½ï¼Œæ€§èƒ½ä¼˜ç§€
 * åŸç†ï¼šåªåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶åŠ é”ï¼Œåç»­ç›´æ¥è¿”å›
 */
class DoubleCheckLockSingleton {
    // â”€â”€ volatile ä¿è¯å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åº â”€â”€
    private static volatile DoubleCheckLockSingleton instance;

    private DoubleCheckLockSingleton() {
        System.out.println("ğŸ”„ åŒé‡æ£€æŸ¥é”å•ä¾‹ï¼šå®ä¾‹å·²åˆ›å»º");
    }

    // â”€â”€ åŒé‡æ£€æŸ¥ â”€â”€
    public static DoubleCheckLockSingleton getInstance() {
        // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼šä¸åŠ é”ï¼Œå¿«é€Ÿåˆ¤æ–­
        if (instance == null) {
            synchronized (DoubleCheckLockSingleton.class) {
                // ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼šåŠ é”åå†æ¬¡åˆ¤æ–­
                if (instance == null) {
                    instance = new DoubleCheckLockSingleton();
                }
            }
        }
        return instance;
    }

    public void doSomething() {
        System.out.println("ğŸ“Œ åŒé‡æ£€æŸ¥é”å•ä¾‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘");
    }
}

// ==================== 5. é™æ€å†…éƒ¨ç±» ====================

/**
 * é™æ€å†…éƒ¨ç±»å•ä¾‹
 * åˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨å’Œå»¶è¿ŸåŠ è½½
 *
 * ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½ï¼Œæ— é”ï¼Œæ€§èƒ½æœ€ä¼˜
 * åŸç†ï¼šå†…éƒ¨ç±»åœ¨å¤–éƒ¨ç±»è°ƒç”¨æ—¶æ‰åŠ è½½
 */
class StaticInnerClassSingleton {

    // â”€â”€ ç§æœ‰æ„é€ æ–¹æ³• â”€â”€
    private StaticInnerClassSingleton() {
        System.out.println("ğŸ”„ é™æ€å†…éƒ¨ç±»å•ä¾‹ï¼šå®ä¾‹å·²åˆ›å»º");
    }

    // â”€â”€ é™æ€å†…éƒ¨ç±»ï¼ŒæŒæœ‰å•ä¾‹å®ä¾‹ â”€â”€
    private static class Holder {
        // é™æ€æˆå‘˜å˜é‡åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–
        private static final StaticInnerClassSingleton INSTANCE =
            new StaticInnerClassSingleton();
    }

    // â”€â”€ å…¬å…±è®¿é—®æ–¹æ³• â”€â”€
    public static StaticInnerClassSingleton getInstance() {
        return Holder.INSTANCE;
    }

    public void doSomething() {
        System.out.println("ğŸ“Œ é™æ€å†…éƒ¨ç±»å•ä¾‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘");
    }
}

// ==================== 6. æšä¸¾å•ä¾‹ ====================

/**
 * æšä¸¾å•ä¾‹
 * åˆ©ç”¨æšä¸¾ç‰¹æ€§å®ç°å•ä¾‹
 *
 * ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œè‡ªåŠ¨æ”¯æŒåºåˆ—åŒ–ï¼Œé˜²æ­¢åå°„æ”»å‡»
 * ç¼ºç‚¹ï¼šä¸æ”¯æŒå»¶è¿ŸåŠ è½½
 */
enum EnumSingleton {
    // æšä¸¾å®ä¾‹æœ¬èº«å°±æ˜¯å•ä¾‹
    INSTANCE;

    // â”€â”€ ä¸šåŠ¡æ–¹æ³• â”€â”€
    public void doSomething() {
        System.out.println("ğŸ“Œ æšä¸¾å•ä¾‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘");
    }

    // â”€â”€ å…¶ä»–æ–¹æ³• â”€â”€
    public String getInfo() {
        return "æšä¸¾å•ä¾‹ä¿¡æ¯";
    }

    // æšä¸¾çš„æ„é€ æ–¹æ³•è‡ªåŠ¨è¢«è°ƒç”¨
    static {
        System.out.println("ğŸ”„ æšä¸¾å•ä¾‹ï¼šå®ä¾‹å·²åˆ›å»º");
    }
}

// ==================== 7. å¸¦å‚æ•°çš„å•ä¾‹å·¥å‚ ====================

/**
 * æ•°æ®åº“é…ç½®
 */
class DatabaseConfig {
    private String url;
    private String username;
    private String password;
    private int maxConnections;

    public DatabaseConfig(String url, String username, String password, int maxConnections) {
        this.url = url;
        this.username = username;
        this.password = password;
        this.maxConnections = maxConnections;
    }

    public String getUrl() { return url; }
    public String getUsername() { return username; }
    public int getMaxConnections() { return maxConnections; }
}

/**
 * æ•°æ®åº“è¿æ¥æ± ç®¡ç†å™¨ - å¸¦å‚æ•°çš„å•ä¾‹
 */
class ConnectionPoolManager {
    private static ConnectionPoolManager instance;

    private DatabaseConfig config;
    private List<String> activeConnections;
    private AtomicInteger connectionCount;

    private ConnectionPoolManager(DatabaseConfig config) {
        this.config = config;
        this.activeConnections = new ArrayList<>();
        this.connectionCount = new AtomicInteger(0);
        System.out.println("ğŸ”„ è¿æ¥æ± ç®¡ç†å™¨åˆå§‹åŒ–");
        System.out.println("   URL: " + config.getUrl());
        System.out.println("   æœ€å¤§è¿æ¥æ•°: " + config.getMaxConnections());
    }

    /**
     * è·å–å•ä¾‹å®ä¾‹ï¼ˆå¸¦åˆå§‹åŒ–å‚æ•°ï¼‰
     */
    public static synchronized ConnectionPoolManager getInstance(DatabaseConfig config) {
        if (instance == null && config != null) {
            instance = new ConnectionPoolManager(config);
        }
        return instance;
    }

    /**
     * è·å–å•ä¾‹å®ä¾‹ï¼ˆä¸å¸¦å‚æ•°ï¼‰
     */
    public static ConnectionPoolManager getInstance() {
        if (instance == null) {
            throw new IllegalStateException("è¿æ¥æ± æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆè°ƒç”¨ getInstance(DatabaseConfig)");
        }
        return instance;
    }

    /**
     * è·å–è¿æ¥
     */
    public String getConnection() {
        if (activeConnections.size() >= config.getMaxConnections()) {
            throw new RuntimeException("è¿æ¥æ± å·²æ»¡");
        }

        String connectionId = "conn-" + connectionCount.incrementAndGet();
        activeConnections.add(connectionId);

        System.out.println("ğŸ”Œ è·å–è¿æ¥: " + connectionId);
        System.out.println("   æ´»è·ƒè¿æ¥æ•°: " + activeConnections.size() + "/" + config.getMaxConnections());

        return connectionId;
    }

    /**
     * é‡Šæ”¾è¿æ¥
     */
    public void releaseConnection(String connectionId) {
        activeConnections.remove(connectionId);
        System.out.println("âœ… é‡Šæ”¾è¿æ¥: " + connectionId);
        System.out.println("   æ´»è·ƒè¿æ¥æ•°: " + activeConnections.size() + "/" + config.getMaxConnections());
    }

    /**
     * è·å–è¿æ¥æ± çŠ¶æ€
     */
    public void printPoolStatus() {
        System.out.println("\n" + "=".repeat(50));
        System.out.println("           è¿æ¥æ± çŠ¶æ€");
        System.out.println("=".repeat(50));
        System.out.println("æ•°æ®åº“: " + config.getUrl());
        System.out.println("ç”¨æˆ·å: " + config.getUsername());
        System.out.println("æ´»è·ƒè¿æ¥æ•°: " + activeConnections.size());
        System.out.println("æœ€å¤§è¿æ¥æ•°: " + config.getMaxConnections());
        System.out.println("æ€»åˆ›å»ºè¿æ¥æ•°: " + connectionCount.get());
        System.out.println("=".repeat(50) + "\n");
    }
}

// ==================== 8. æ³¨å†Œå¼å•ä¾‹ï¼ˆå®¹å™¨ç®¡ç†ï¼‰ ====================

/**
 * å•ä¾‹å®¹å™¨
 * ç®¡ç†å¤šä¸ªå•ä¾‹å®ä¾‹
 */
class SingletonRegistry {
    private static final Map<String, Object> registry = new ConcurrentHashMap<>();

    /**
     * æ³¨å†Œå•ä¾‹
     */
    public static void register(String key, Object instance) {
        registry.put(key, instance);
        System.out.println("ğŸ“‹ æ³¨å†Œå•ä¾‹: " + key);
    }

    /**
     * è·å–å•ä¾‹
     */
    public static <T> T getInstance(String key, Class<T> type) {
        Object instance = registry.get(key);
        if (instance != null && type.isInstance(instance)) {
            return type.cast(instance);
        }
        return null;
    }

    /**
     * è·å–æ‰€æœ‰æ³¨å†Œçš„åç§°
     */
    public static Set<String> getAllKeys() {
        return new HashSet<>(registry.keySet());
    }
}

// ==================== å®¢æˆ·ç«¯ä»£ç  ====================

/**
 * å•ä¾‹æ¨¡å¼æ¼”ç¤º
 */
class SingletonPatternDemo {
    public static void main(String[] args) {
        System.out.println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘            ğŸ”’ å•ä¾‹æ¨¡å¼ - å®ç°æ–¹å¼å¯¹æ¯”                   â•‘");
        System.out.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

        // â”€â”€ 1. é¥¿æ±‰å¼æ¼”ç¤º â”€â”€
        demonstrateEagerSingleton();

        // â”€â”€ 2. æ‡’æ±‰å¼æ¼”ç¤º â”€â”€
        demonstrateLazySingleton();

        // â”€â”€ 3. åŒé‡æ£€æŸ¥é”æ¼”ç¤º â”€â”€
        demonstrateDoubleCheckLock();

        // â”€â”€ 4. é™æ€å†…éƒ¨ç±»æ¼”ç¤º â”€â”€
        demonstrateStaticInnerClass();

        // â”€â”€ 5. æšä¸¾å•ä¾‹æ¼”ç¤º â”€â”€
        demonstrateEnumSingleton();

        // â”€â”€ 6. å¸¦å‚æ•°å•ä¾‹æ¼”ç¤º â”€â”€
        demonstrateConnectionPool();

        // â”€â”€ 7. æ³¨å†Œå¼å•ä¾‹æ¼”ç¤º â”€â”€
        demonstrateSingletonRegistry();
    }

    /**
     * æ¼”ç¤ºé¥¿æ±‰å¼
     */
    private static void demonstrateEagerSingleton() {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("              1. é¥¿æ±‰å¼å•ä¾‹");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

        EagerSingleton instance1 = EagerSingleton.getInstance();
        EagerSingleton instance2 = EagerSingleton.getInstance();

        System.out.println("instance1 == instance2: " + (instance1 == instance2));
        System.out.println("instance1.hashCode(): " + instance1.hashCode());
        System.out.println("instance2.hashCode(): " + instance2.hashCode());
        System.out.println();
    }

    /**
     * æ¼”ç¤ºæ‡’æ±‰å¼
     */
    private static void demonstrateLazySingleton() {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("              2. æ‡’æ±‰å¼å•ä¾‹");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

        LazySingletonSync instance1 = LazySingletonSync.getInstance();
        LazySingletonSync instance2 = LazySingletonSync.getInstance();

        System.out.println("instance1 == instance2: " + (instance1 == instance2));
        System.out.println();
    }

    /**
     * æ¼”ç¤ºåŒé‡æ£€æŸ¥é”
     */
    private static void demonstrateDoubleCheckLock() {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("              3. åŒé‡æ£€æŸ¥é”å•ä¾‹");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

        DoubleCheckLockSingleton instance1 = DoubleCheckLockSingleton.getInstance();
        DoubleCheckLockSingleton instance2 = DoubleCheckLockSingleton.getInstance();

        System.out.println("instance1 == instance2: " + (instance1 == instance2));
        System.out.println();
    }

    /**
     * æ¼”ç¤ºé™æ€å†…éƒ¨ç±»
     */
    private static void demonstrateStaticInnerClass() {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("              4. é™æ€å†…éƒ¨ç±»å•ä¾‹");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

        StaticInnerClassSingleton instance1 = StaticInnerClassSingleton.getInstance();
        StaticInnerClassSingleton instance2 = StaticInnerClassSingleton.getInstance();

        System.out.println("instance1 == instance2: " + (instance1 == instance2));
        System.out.println();
    }

    /**
     * æ¼”ç¤ºæšä¸¾å•ä¾‹
     */
    private static void demonstrateEnumSingleton() {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("              5. æšä¸¾å•ä¾‹");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

        EnumSingleton instance1 = EnumSingleton.INSTANCE;
        EnumSingleton instance2 = EnumSingleton.INSTANCE;

        System.out.println("instance1 == instance2: " + (instance1 == instance2));
        System.out.println("instance1.getInfo(): " + instance1.getInfo());
        System.out.println();
    }

    /**
     * æ¼”ç¤ºè¿æ¥æ± å•ä¾‹
     */
    private static void demonstrateConnectionPool() {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("              6. æ•°æ®åº“è¿æ¥æ± ç®¡ç†å™¨");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

        // åˆå§‹åŒ–è¿æ¥æ± 
        DatabaseConfig config = new DatabaseConfig(
            "jdbc:mysql://localhost:3306/mydb",
            "root",
            "password",
            5
        );
        ConnectionPoolManager pool = ConnectionPoolManager.getInstance(config);

        // è·å–è¿æ¥
        String conn1 = pool.getConnection();
        String conn2 = pool.getConnection();

        // æŸ¥çœ‹çŠ¶æ€
        pool.printPoolStatus();

        // é‡Šæ”¾è¿æ¥
        pool.releaseConnection(conn1);
        pool.releaseConnection(conn2);

        // å†æ¬¡è·å–è¿æ¥
        String conn3 = pool.getConnection();
        pool.printPoolStatus();
    }

    /**
     * æ¼”ç¤ºæ³¨å†Œå¼å•ä¾‹
     */
    private static void demonstrateSingletonRegistry() {
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
        System.out.println("              7. æ³¨å†Œå¼å•ä¾‹ï¼ˆå®¹å™¨ç®¡ç†ï¼‰");
        System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");

        // æ³¨å†Œå•ä¾‹
        SingletonRegistry.register("userCache", new HashMap<String, String>());
        SingletonRegistry.register("configCache", new Properties());

        // è·å–å•ä¾‹
        @SuppressWarnings("unchecked")
        Map<String, String> userCache = SingletonRegistry.getInstance("userCache", Map.class);

        // ä½¿ç”¨å•ä¾‹
        userCache.put("user1", "å¼ ä¸‰");
        userCache.put("user2", "æå››");

        System.out.println("å·²æ³¨å†Œçš„å•ä¾‹: " + SingletonRegistry.getAllKeys());
        System.out.println("ç”¨æˆ·ç¼“å­˜å†…å®¹: " + userCache);
    }
}
```

---

#### åå°„ä¸åºåˆ—åŒ–ç ´åå•ä¾‹

å•ä¾‹æ¨¡å¼å¯èƒ½è¢«åå°„æˆ–åºåˆ—åŒ–ç ´åï¼Œéœ€è¦é˜²å¾¡ã€‚

```java
import java.io.*;

// ==================== é˜²åå°„æ”»å‡» ====================

/**
 * é˜²åå°„æ”»å‡»çš„å•ä¾‹
 */
class ReflectionSafeSingleton {
    private static ReflectionSafeSingleton instance;

    private ReflectionSafeSingleton() {
        // é˜²æ­¢åå°„åˆ›å»ºå®ä¾‹
        if (instance != null) {
            throw new IllegalStateException("å•ä¾‹å·²è¢«åˆ›å»ºï¼Œç¦æ­¢é€šè¿‡åå°„åˆ›å»ºæ–°å®ä¾‹");
        }
        System.out.println("ğŸ”„ é˜²åå°„å•ä¾‹ï¼šå®ä¾‹å·²åˆ›å»º");
    }

    public static synchronized ReflectionSafeSingleton getInstance() {
        if (instance == null) {
            instance = new ReflectionSafeSingleton();
        }
        return instance;
    }
}

// ==================== é˜²åºåˆ—åŒ–ç ´å ====================

/**
 * é˜²åºåˆ—åŒ–ç ´åçš„å•ä¾‹
 */
class SerializableSingleton implements Serializable {
    private static final long serialVersionUID = 1L;

    private static SerializableSingleton instance;

    private SerializableSingleton() {
        System.out.println("ğŸ”„ é˜²åºåˆ—åŒ–å•ä¾‹ï¼šå®ä¾‹å·²åˆ›å»º");
    }

    public static synchronized SerializableSingleton getInstance() {
        if (instance == null) {
            instance = new SerializableSingleton();
        }
        return instance;
    }

    /**
     * é˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹
     * ååºåˆ—åŒ–æ—¶ï¼ŒreadResolve æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œè¿”å›æŒ‡å®šçš„å•ä¾‹å®ä¾‹
     */
    private Object readResolve() {
        return getInstance();
    }
}

// ==================== æ¼”ç¤ºä»£ç  ====================

class SingletonSafetyDemo {
    public static void main(String[] args) throws Exception {
        // â”€â”€ æ¼”ç¤ºåå°„ç ´å â”€â”€
        demonstrateReflectionAttack();

        // â”€â”€ æ¼”ç¤ºåºåˆ—åŒ–ç ´å â”€â”€
        demonstrateSerializationAttack();
    }

    /**
     * æ¼”ç¤ºåå°„æ”»å‡»
     */
    private static void demonstrateReflectionAttack() throws Exception {
        System.out.println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘            ğŸ›¡ï¸  åå°„æ”»å‡»æ¼”ç¤º                              â•‘");
        System.out.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

        // è·å–æ­£å¸¸å®ä¾‹
        ReflectionSafeSingleton instance1 = ReflectionSafeSingleton.getInstance();

        try {
            // å°è¯•é€šè¿‡åå°„åˆ›å»ºæ–°å®ä¾‹
            java.lang.reflect.Constructor<ReflectionSafeSingleton> constructor =
                ReflectionSafeSingleton.class.getDeclaredConstructor();
            constructor.setAccessible(true);
            ReflectionSafeSingleton instance2 = constructor.newInstance();

            System.out.println("åå°„åˆ›å»ºæˆåŠŸï¼");
        } catch (IllegalStateException e) {
            System.out.println("âŒ åå°„æ”»å‡»è¢«é˜»æ­¢: " + e.getMessage());
        }
    }

    /**
     * æ¼”ç¤ºåºåˆ—åŒ–æ”»å‡»
     */
    private static void demonstrateSerializationAttack() throws Exception {
        System.out.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘            ğŸ›¡ï¸  åºåˆ—åŒ–æ”»å‡»æ¼”ç¤º                            â•‘");
        System.out.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

        // è·å–å®ä¾‹
        SerializableSingleton instance1 = SerializableSingleton.getInstance();
        System.out.println("åŸå§‹å®ä¾‹: " + instance1.hashCode());

        // åºåˆ—åŒ–
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        ObjectOutputStream oos = new ObjectOutputStream(bos);
        oos.writeObject(instance1);
        oos.close();

        // ååºåˆ—åŒ–
        ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());
        ObjectInputStream ois = new ObjectInputStream(bis);
        SerializableSingleton instance2 = (SerializableSingleton) ois.readObject();
        ois.close();

        System.out.println("ååºåˆ—åŒ–å®ä¾‹: " + instance2.hashCode());
        System.out.println("instance1 == instance2: " + (instance1 == instance2));
    }
}
```

---

#### å®é™…åº”ç”¨ï¼šSpring Bean å•ä¾‹

Spring æ¡†æ¶é»˜è®¤ä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç† Beanã€‚

```
                    Spring Bean å•ä¾‹ç®¡ç†

   ApplicationContext
            â”‚
            â”‚ getBean("userService")
            â†“
         BeanFactory
            â”‚
            â”‚ 1. æ£€æŸ¥ç¼“å­˜
            â”‚ 2. åˆ›å»º Beanï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰
            â”‚ 3. ç¼“å­˜ Bean
            â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  singletonObjects â”‚
       â”‚    (ç¼“å­˜æ± )       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â†“
           è¿”å› Bean å®ä¾‹
```

**Spring Bean å•ä¾‹ç¤ºä¾‹**

```java
import org.springframework.context.annotation.*;
import org.springframework.stereotype.Service;

/**
 * ç”¨æˆ·æœåŠ¡ - Spring å•ä¾‹ Bean
 */
@Service
public class UserService {

    private int requestCount = 0;

    public void handleRequest() {
        requestCount++;
        System.out.println("å¤„ç†è¯·æ±‚ #" + requestCount);
        System.out.println("å½“å‰ Bean: " + this.hashCode());
    }

    public int getRequestCount() {
        return requestCount;
    }
}

/**
 * é…ç½®ç±»
 */
@Configuration
@ComponentScan
public class AppConfig {
    // é»˜è®¤æƒ…å†µä¸‹ï¼Œ@Service æ³¨è§£çš„ Bean å°±æ˜¯å•ä¾‹
    // ç­‰ä»·äº @Scope("singleton")
}

/**
 * Spring å•ä¾‹æ¼”ç¤º
 */
public class SpringSingletonDemo {
    public static void main(String[] args) {
        // åˆ›å»º Spring å®¹å™¨
        AnnotationConfigApplicationContext context =
            new AnnotationConfigApplicationContext(AppConfig.class);

        // è·å–ä¸¤æ¬¡ Bean
        UserService userService1 = context.getBean(UserService.class);
        UserService userService2 = context.getBean(UserService.class);

        System.out.println("userService1 == userService2: " + (userService1 == userService2));
        System.out.println("userService1 hashCode: " + userService1.hashCode());
        System.out.println("userService2 hashCode: " + userService2.hashCode());

        // è°ƒç”¨æ–¹æ³•éªŒè¯æ˜¯åŒä¸€ä¸ªå®ä¾‹
        userService1.handleRequest();
        userService2.handleRequest();
        System.out.println("æ€»è¯·æ±‚æ•°: " + userService1.getRequestCount());

        context.close();
    }
}
```

**Spring Bean ä½œç”¨åŸŸå¯¹æ¯”**

| ä½œç”¨åŸŸ | è¯´æ˜ | å®ä¾‹æ•°é‡ |
|:------|:----|:--------:|
| singleton | å•ä¾‹ï¼ˆé»˜è®¤ï¼‰ | æ¯ä¸ªå®¹å™¨ 1 ä¸ª |
| prototype | åŸå‹ï¼Œæ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹ | æ¯æ¬¡è¯·æ±‚ 1 ä¸ª |
| request | æ¯ä¸ª HTTP è¯·æ±‚ä¸€ä¸ªå®ä¾‹ | æ¯ä¸ª HTTP è¯·æ±‚ 1 ä¸ª |
| session | æ¯ä¸ª HTTP Session ä¸€ä¸ªå®ä¾‹ | æ¯ä¸ª Session 1 ä¸ª |
| application | æ•´ä¸ª Web åº”ç”¨ä¸€ä¸ªå®ä¾‹ | æ¯ä¸ªåº”ç”¨ 1 ä¸ª |

---

#### å®é™…åº”ç”¨ï¼šRuntime ç±»

JDK ä¸­çš„ Runtime ç±»æ˜¯ç»å…¸çš„å•ä¾‹æ¨¡å¼åº”ç”¨ã€‚

```java
import java.io.IOException;

/**
 * JDK Runtime ç±»å•ä¾‹æ¼”ç¤º
 */
class RuntimeSingletonDemo {
    public static void main(String[] args) throws IOException {
        System.out.println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        System.out.println("â•‘            ğŸ’» JDK Runtime å•ä¾‹æ¼”ç¤º                     â•‘");
        System.out.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

        // è·å– Runtime å®ä¾‹ï¼ˆå•ä¾‹ï¼‰
        Runtime runtime1 = Runtime.getRuntime();
        Runtime runtime2 = Runtime.getRuntime();

        System.out.println("runtime1 == runtime2: " + (runtime1 == runtime2));
        System.out.println("Available Processors: " + runtime1.availableProcessors());
        System.out.println("Free Memory: " + (runtime1.freeMemory() / 1024 / 1024) + " MB");
        System.out.println("Max Memory: " + (runtime1.maxMemory() / 1024 / 1024) + " MB");
        System.out.println("Total Memory: " + (runtime1.totalMemory() / 1024 / 1024) + " MB");

        // æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
        System.out.println("\næ‰§è¡Œç³»ç»Ÿå‘½ä»¤:");
        if (System.getProperty("os.name").toLowerCase().contains("win")) {
            Process process = runtime1.exec("cmd /c echo Hello from Java!");
            java.io.BufferedReader reader = new java.io.BufferedReader(
                new java.io.InputStreamReader(process.getInputStream())
            );
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println("   " + line);
            }
        }
    }
}
```

---

#### JDK ä¸­çš„å•ä¾‹ç±»

| ç±»å | è·å–æ–¹å¼ | è¯´æ˜ |
|:----|:--------|:----|
| `Runtime` | `Runtime.getRuntime()` | è¿è¡Œæ—¶ç¯å¢ƒ |
| `Desktop` | `Desktop.getDesktop()` | æ¡Œé¢æ“ä½œ |
| `System` | `System.out/in/err` | æ ‡å‡†è¾“å…¥è¾“å‡ºï¼ˆç±»æœ¬èº«å°±æ˜¯å•ä¾‹ï¼‰ |
| `Collections.EMPTY_*` | å¸¸é‡å¼•ç”¨ | ç©ºé›†åˆå•ä¾‹ |
| `Optional.empty()` | é™æ€æ–¹æ³• | ç©º Optional å•ä¾‹ |

---

#### ä¼˜ç¼ºç‚¹å¯¹æ¯”

| ç±»å‹ | è¯´æ˜ |
|:----|:----|
| âœ… ä¼˜ç‚¹ | â€¢ å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘å†…å­˜å¼€é”€<br>â€¢ é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨<br>â€¢ è®¾ç½®å…¨å±€è®¿é—®ç‚¹ï¼Œä¼˜åŒ–å…±äº«èµ„æºè®¿é—®<br>â€¢ å®ç°ç®€å• |
| âŒ ç¼ºç‚¹ | â€¢ è¿åå•ä¸€èŒè´£åŸåˆ™ï¼ˆå•ä¾‹ç±»æ—¢è¦è´Ÿè´£ä¸šåŠ¡ï¼Œåˆè¦è´Ÿè´£è‡ªèº«ç®¡ç†ï¼‰<br>â€¢ ä¸å®¹æ˜“æ‰©å±•<br>â€¢ å•ä¾‹ç±»æŒæœ‰çŠ¶æ€æ—¶å¯èƒ½å¯¼è‡´é—®é¢˜<br>â€¢ æµ‹è¯•å›°éš¾ï¼ˆå•ä¾‹çŠ¶æ€æŒä¹…åŒ–ï¼‰ |

---

#### é€‚ç”¨åœºæ™¯

| åœºæ™¯ | ç¤ºä¾‹ |
|:----:|:----|
| 1 | æ•°æ®åº“è¿æ¥æ±  |
| 2 | é…ç½®ç®¡ç†å™¨ |
| 3 | æ—¥å¿—è®°å½•å™¨ |
| 4 | ç¼“å­˜ç®¡ç† |
| 5 | çº¿ç¨‹æ±  |
| 6 | ç³»ç»Ÿå·¥å…·ç±»ï¼ˆRuntimeï¼‰ |

---

#### æ€»ç»“

| æ¦‚å¿µ | è¯´æ˜ |
|:----|:----|
| æ ¸å¿ƒæ€æƒ³ | ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ |
| æ¨èå®ç° | é™æ€å†…éƒ¨ç±»ã€æšä¸¾ |
| æ³¨æ„äº‹é¡¹ | é˜²åå°„ã€é˜²åºåˆ—åŒ–ç ´å |
| åº”ç”¨åœºæ™¯ | èµ„æºç®¡ç†ã€é…ç½®ç®¡ç†ã€ç¼“å­˜ |